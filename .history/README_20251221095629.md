# üì± E-Commerce Phone Store - Monorepo Project

> üî§ **Ng√¥n ng·ªØ m·∫∑c ƒë·ªãnh: ti·∫øng Vi·ªát** cho t√†i li·ªáu, PR/Issue v√† b√¨nh lu·∫≠n review.

D·ª± √°n monorepo bao g·ªìm backend API (Express.js + TypeScript) v√† 2 frontend apps (Next.js) cho h·ªá th·ªëng b√°n ƒëi·ªán tho·∫°i v√† s·∫£n ph·∫©m Apple.

## üìã M·ª•c L·ª•c

- [T·ªïng Quan](#t·ªïng-quan)
- [Tech Stack](#tech-stack)
- [C·∫•u Tr√∫c D·ª± √Ån](#c·∫•u-tr√∫c-d·ª±-√°n)
- [H∆∞·ªõng D·∫´n C√†i ƒê·∫∑t](#h∆∞·ªõng-d·∫´n-c√†i-ƒë·∫∑t)
- [Ch·∫°y ·ª®ng D·ª•ng](#ch·∫°y-·ª©ng-d·ª•ng)
- [Bi·∫øn M√¥i Tr∆∞·ªùng](#bi·∫øn-m√¥i-tr∆∞·ªùng)
- [API Documentation](#api-documentation)
- [ƒê√≥ng G√≥p](#ƒë√≥ng-g√≥p)
- [Troubleshooting](#troubleshooting)

## üéØ T·ªïng Quan

D·ª± √°n n√†y l√† m·ªôt h·ªá th·ªëng e-commerce ho√†n ch·ªânh b√°n s·∫£n ph·∫©m Apple (ƒëi·ªán tho·∫°i, tablet, laptop, ƒë·ªìng h·ªì, ph·ª• ki·ªán) v·ªõi:

- **Backend API** (`backend/`): RESTful API v·ªõi authentication, RBAC, session management, v√† x·ª≠ l√Ω thanh to√°n
- **Customer Frontend** (`phone-app/`): Trang web kh√°ch h√†ng v·ªõi Next.js 14 App Router
- **Admin Dashboard** (`admin-dashboard/`): B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n tr·ªã v·ªõi Next.js 14, shadcn/ui v√† React Query
- **Database**: PostgreSQL v·ªõi Prisma ORM, h·ªó tr·ª£ category hierarchy linh ho·∫°t

## üõ† Tech Stack

### Backend (`backend/`)

- **Runtime**: Node.js 20+ + TypeScript 5.x
- **Framework**: Express.js 4.x
- **Database**: PostgreSQL 12+
- **ORM**: Prisma 6.x
- **Authentication**: JWT (Access + Refresh Token)
- **Session**: RefreshSession model v·ªõi HTTP-only cookies
- **Validation**: Zod schemas
- **Security**: Helmet, CORS, Rate Limiting, bcrypt
- **File Upload**: Multer
- **API Testing**: `.http` files (VS Code REST Client)

### Frontend - Customer App (`phone-app/`)

- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript 5.x
- **UI Library**: Radix UI + shadcn/ui
- **Styling**: Tailwind CSS 4.x
- **Icons**: Lucide React
- **Forms**: React Hook Form + Zod
- **Theme**: next-themes (dark/light mode)
- **API Client**: Custom fetch-based client v·ªõi auto-refresh

### Frontend - Admin Dashboard (`admin-dashboard/`)

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript 5.x
- **UI Components**: shadcn/ui + Radix UI
- **Styling**: Tailwind CSS 3.x
- **State Management**: Zustand 4.x
- **Server State**: React Query (@tanstack/react-query 5.x)
- **Forms**: React Hook Form + Zod
- **API Client**: Axios v·ªõi JWT interceptor
- **Charts**: Recharts 2.x
- **Notifications**: Sonner
- **Icons**: Lucide React

### DevOps & Tools

- **Containerization**: Docker & Docker Compose
- **Package Manager**: npm
- **Version Control**: Git
- **Development**: Nodemon, ts-node, tsx

## üìÅ C·∫•u Tr√∫c D·ª± √Ån

```
d:\Work\newpro/
‚îú‚îÄ‚îÄ backend/                          # Backend API (Express + TypeScript)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.ts                   # Express app setup v·ªõi middlewares
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                 # Server entry point
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/             # Request handlers (auth, product, order, cart, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                # Business logic layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                  # API routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.route.ts       # /api/auth/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.route.ts    # /api/products/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ category.route.ts   # /api/categories/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order.route.ts      # /api/orders/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.route.ts       # /api/cart/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.route.ts      # /api/admin/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.route.ts  # /api/dashboard/*
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload.route.ts     # /api/upload/*
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/                 # Zod validation schemas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/             # auth, error handling, validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                   # jwt, env, prisma client, cookies
‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma           # Database schema v·ªõi Category hierarchy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seed.ts                 # Seed data
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/             # Database migrations
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-admin.ts         # Script t·∫°o admin user
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fix-admin-role.ts       # Script fix admin role
‚îÇ   ‚îú‚îÄ‚îÄ public/pictures/            # Product images (static files)
‚îÇ   ‚îú‚îÄ‚îÄ uploads/                    # User uploaded files
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îî‚îÄ‚îÄ *.http                      # API testing files
‚îÇ
‚îú‚îÄ‚îÄ phone-app/                        # Customer Frontend (Next.js 15)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx          # Root layout
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            # Home page
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/             # Auth routes (login, register)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (account)/          # Account routes (profile, orders)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/           # Product pages
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ checkout/           # Checkout flow
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/             # Reusable React components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth-provider.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login-form.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                 # shadcn/ui components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                    # Utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts              # API client
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth-client.ts      # Auth utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ token.ts            # Token management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/                  # Custom React hooks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                  # Helper functions
‚îÇ   ‚îú‚îÄ‚îÄ public/pictures/            # Static product images
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îî‚îÄ‚îÄ next.config.ts
‚îÇ
‚îú‚îÄ‚îÄ admin-dashboard/                  # Admin Dashboard (Next.js 14)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx          # Root layout v·ªõi providers
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers.tsx       # React Query + Toast providers
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/             # Auth routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (dashboard)/        # Protected admin routes
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ layout.tsx      # Dashboard layout (sidebar + header)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx        # Dashboard home
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ products/       # Product management
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ orders/         # Order management
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ customers/      # Customer management
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ categories/     # Category management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/             # sidebar, header
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/           # Product-specific components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/          # Dashboard widgets
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                 # shadcn/ui components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-auth.ts         # React Query auth hook
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ use-categories.ts   # React Query category hook
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts              # Axios instance v·ªõi JWT interceptor
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.ts             # Auth utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/                  # TypeScript types
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store/                  # Zustand stores
‚îÇ   ‚îú‚îÄ‚îÄ public/pictures/            # Shared product images
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.ts
‚îÇ   ‚îî‚îÄ‚îÄ DESIGN_SYSTEM.md            # Design system documentation
‚îÇ
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ copilot-instructions.md     # GitHub Copilot instructions
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ GIT_TROUBLESHOOTING.md          # Git troubleshooting guide
‚îú‚îÄ‚îÄ BACKEND_SUMMARY.md              # Backend documentation
‚îú‚îÄ‚îÄ ORDER_FLOW_GUIDE.md             # Order flow documentation
‚îî‚îÄ‚îÄ README.md                        # This file
```

## üöÄ H∆∞·ªõng D·∫´n C√†i ƒê·∫∑t

### Y√™u C·∫ßu Ti√™n Quy·∫øt

- Node.js >= 16.x
- npm >= 8.x
- PostgreSQL >= 12.x (for local development)
- Docker & Docker Compose (optional, for containerized setup)

### Clone Repository

```bash
git clone https://github.com/huyshelby/tesst.git
cd newpro
```

### Backend Setup

```bash
cd backend

# C√†i dependencies
npm install

# Setup environment variables (t·∫°o file .env)
# Copy t·ª´ m·∫´u b√™n d∆∞·ªõi ho·∫∑c xem ph·∫ßn Bi·∫øn M√¥i Tr∆∞·ªùng

# Kh·ªüi ƒë·ªông PostgreSQL (s·ª≠ d·ª•ng Docker - recommended)
docker-compose up -d

# T·∫°o database v√† ch·∫°y migrations
npx prisma migrate dev

# (Optional) Seed database v·ªõi sample data
npm run seed

# (Optional) T·∫°o admin user
npm run create-admin

# Kh·ªüi ƒë·ªông dev server
npm run dev
# Server ch·∫°y t·∫°i http://localhost:4000
```

### Frontend Setup

**Phone App (Customer)**:

```bash
cd phone-app

# C√†i dependencies
npm install

# Setup environment variables (t·∫°o file .env.local)
# NEXT_PUBLIC_API_BASE_URL=http://localhost:4000/api

# Ch·∫°y dev server
npm run dev
# App ch·∫°y t·∫°i http://localhost:3000
```

**Admin Dashboard**:

```bash
cd admin-dashboard

# C√†i dependencies
npm install

# Setup environment variables (t·∫°o file .env.local)
# NEXT_PUBLIC_API_URL=http://localhost:4000/api

# Ch·∫°y dev server
npm run dev
# Dashboard ch·∫°y t·∫°i http://localhost:3001
```

## üé¨ Ch·∫°y ·ª®ng D·ª•ng

### Development Mode

**Backend** (Terminal 1):

```bash
cd backend
npm run dev
# Server ch·∫°y t·∫°i http://localhost:3001
```

**Frontend** (Terminal 2):

```bash
cd phone-app
npm run dev
# App ch·∫°y t·∫°i http://localhost:3000
```

### S·ª≠ D·ª•ng Docker Compose

```bash
cd backend
docker-compose up
```

ƒêi·ªÅu n√†y s·∫Ω:

- Kh·ªüi ƒë·ªông PostgreSQL container
- T·ª± ƒë·ªông ch·∫°y migrations
- Chu·∫©n b·ªã database cho development

### Build & Production

**Backend**:

```bash
cd backend
npm run build
npm start
```

**Frontend**:

```bash
cd phone-app
npm run build
npm start
```

## üîê Bi·∫øn M√¥i Tr∆∞·ªùng

### Backend (.env)

```env
# Server
PORT=3001
NODE_ENV=development

# Database
DATABASE_URL="postgresql://user:password@localhost:5432/phone_app"

# JWT
JWT_SECRET=your_jwt_secret_key_here

# Session
SESSION_SECRET=your_session_secret_key_here

# CORS
CORS_ORIGIN=http://localhost:3000

# Email (optional)
EMAIL_USER=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
```

### Frontend (.env.local)

```env
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## üìö API Documentation

### Authentication Routes

- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/logout` - User logout
- `POST /api/auth/refresh` - Refresh JWT token
- `POST /api/auth/forgot` - Forgot password
- `POST /api/auth/reset` - Reset password

### User Routes

- `GET /api/users/me` - Get current user profile
- `PUT /api/users/me` - Update user profile
- `GET /api/users/:id` - Get user by ID

### Admin Routes (Protected - Requires Admin Role)

- `GET /api/admin/users` - List all users
- `POST /api/admin/users/:id/role` - Assign role to user
- `DELETE /api/admin/users/:id` - Delete user

### Testing

S·ª≠ d·ª•ng file `.http` ƒë·ªÉ test API:

```bash
# V·ªõi VS Code REST Client extension ho·∫∑c ƒë∆°n gi·∫£n:
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password"}'
```

Chi ti·∫øt xem [API-RBAC.md](./backend/API-RBAC.md)

## üìù Database Schema

### Users

- id (UUID)
- email (unique)
- name
- password (hashed)
- createdAt
- updatedAt

### Sessions

- id (UUID)
- userId (FK)
- token
- expiresAt
- createdAt

### User Roles

- id (UUID)
- userId (FK)
- role (enum: USER, ADMIN, MODERATOR)

### Products, Categories, Orders

(Schema ƒë·∫ßy ƒë·ªß xem trong `prisma/schema.prisma`)

## üë• ƒê√≥ng G√≥p

1. **Fork** repository
2. **T·∫°o branch** cho feature: `git checkout -b feature/your-feature`
3. **Commit** changes: `git commit -m "Add your feature"`
4. **Push** to branch: `git push origin feature/your-feature`
5. **T·∫°o Pull Request**

### Coding Standards

- S·ª≠ d·ª•ng TypeScript
- Follow ESLint rules
- Vi·∫øt comments ti·∫øng Vi·ªát cho logic ph·ª©c t·∫°p
- T·∫°o commit message r√µ r√†ng

## üêõ Troubleshooting

### Git Issues

N·∫øu g·∫∑p l·ªói li√™n quan ƒë·∫øn Git (submodule, large files, etc.):
‚Üí Xem chi ti·∫øt trong [GIT_TROUBLESHOOTING.md](./GIT_TROUBLESHOOTING.md)

### Database Connection

```bash
# Ki·ªÉm tra DATABASE_URL
echo $DATABASE_URL

# Ki·ªÉm tra PostgreSQL service
pg_isready -h localhost -p 5432

# Reset migrations
npx prisma migrate reset
```

### Port Already in Use

```bash
# Windows
netstat -ano | findstr :3001
taskkill /PID <PID> /F

# macOS/Linux
lsof -i :3001
kill -9 <PID>
```

### Node Modules Issues

```bash
# Clear cache
npm cache clean --force

# Reinstall
rm -rf node_modules package-lock.json
npm install
```

## üìû Support & Contact

- **Issues**: GitHub Issues
- **Discussions**: GitHub Discussions
- **Email**: (Add if applicable)

## üìÑ License

MIT License - xem [LICENSE](./LICENSE) file

## üîÑ Changelog

### v1.0.0 (Current)

- ‚úÖ Basic authentication with JWT
- ‚úÖ Role-based access control (RBAC)
- ‚úÖ User session management
- ‚úÖ Next.js frontend with React
- ‚úÖ PostgreSQL database with Prisma
- ‚úÖ Docker support

---

**Cu·ªëi c√πng c·∫≠p nh·∫≠t**: December 13, 2025
